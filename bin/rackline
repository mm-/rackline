#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'rackline'
require 'cloudservers'

class App
  include Methadone::Main
  include Methadone::CLILogging
  include Rackline

  main do |server_name|
    
    if options[:username].nil? || options[:api_key].nil?
      puts "You must specify a username and api_key!"
      puts "rackline --username stuff --api_key 3223dsdfsdc223lkc2lk22l myservername"
      puts
      exit
    end

    un = options[:username]
    ak = options[:api_key]

    # Connect to rackspace cloud
    $cs = CloudServers::Connection.new(:username => "#{un}" , :api_key => "#{ak}")

    # Find our server!
    object = ServerFind.new(server_name)
    object.byname 
  end

  version Rackline::VERSION

  description 'Finds cloudserver by server name'

  arg :server_name, "Server name to search for"

  on("--username un", "Connect with specified username")
  on("--api_key ak", "Connect with specified api_key")
  

  use_log_level_option

  go!
end
